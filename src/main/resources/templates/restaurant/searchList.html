<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>맛집 리뷰 캐러셀</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
    body {
        font-family: Arial, sans-serif;
    }
    .carousel-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        background-color: #f8f9fa;
        padding: 20px;
        height: 850px;
        margin: 50px 0;
    }
    .img-container {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        width: 100%;
    }
    .img-container img {
        width: 100%;
        max-width: 300px;
        height: 200px;
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .restr {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        overflow: hidden;
        padding: 20px;
        text-align: center;
    }
    .review {
        background: #fff;
        border-top: 1px solid #e0e0e0;
        padding: 15px;
        box-sizing: border-box;
        margin-bottom: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .review-list {
        padding: 10px;
    }
    .stars {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px auto;
    }
    .star-wrap {
        display: flex;
        position: relative;
        font-size: 24px;
    }
    .star-wrap > span {
        color: #b3b3b3;
    }
    .star-on {
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        color: #fc7a1e;
        overflow: hidden;
        white-space: nowrap;
        transition: width 0.3s ease;
        width: 0; /* 초기 너비는 0 */
    }
    .star-on-wrap {
        display: flex;
    }
    .carousel-control-prev, .carousel-control-next {
        width: 5%;
    }
    .carousel-control-prev-icon, .carousel-control-next-icon {
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
    }
</style>
</head>
<body>
    <th:block th:include="common/header"></th:block>
    <div class="container mt-5">
        <!-- 캐러셀 -->
        <div id="carouselExampleIndicators" class="carousel slide">
            <div class="carousel-indicators">
                <th:block th:each="data, iterStat : ${restrReviewData}">
                    <button type="button" data-bs-target="#carouselExampleIndicators" 
                            th:attr="data-bs-slide-to=${iterStat.index}" 
                            th:classappend="${iterStat.index == 0} ? 'active' : ''"
                            class="rounded-circle"></button>
                </th:block>
            </div>
            <div class="carousel-inner">
                <th:block th:each="data, iterStat : ${restrReviewData}">
                    <div class="carousel-item" th:classappend="${iterStat.index == 0} ? 'active' : ''">
                        <div class="restr">
                            <a class="img-container" th:href="'/restaurant/restrView?restrNo='+${data.restaurant.restrNo}">
                                <img th:src="'/yomi/' + ${data.restaurant.restrImg1}" alt="Restaurant Image 1">
                                <img th:src="'/yomi/' + ${data.restaurant.restrImg2}" alt="Restaurant Image 2">
                            </a>
                            <div>
                                <div class="stars">
                                    <div class="star-wrap">
                                        <div class="star-on" style="width: 0;">
                                            <div class="star-on-wrap">
                                                <span class="material-icons">grade</span> 
                                                <span class="material-icons">grade</span> 
                                                <span class="material-icons">grade</span>
                                                <span class="material-icons">grade</span> 
                                                <span class="material-icons">grade</span>
                                            </div>
                                        </div>
                                        <span class="material-icons">grade</span> 
                                        <span class="material-icons">grade</span> 
                                        <span class="material-icons">grade</span>
                                        <span class="material-icons">grade</span> 
                                        <span class="material-icons">grade</span>
                                    </div>
                                </div>
                                <input class="star" type="hidden" th:value="${data.restaurant.star}">
                                <h4 th:text="${data.restaurant.restrName}"></h4>
                            </div>
                        </div>
                        <div class="review-list">
                            <th:block th:each="review : ${data.reviewList}">
                                <div class="review">
                                    <div class="stars">
                                        <div class="star-wrap">
                                            <div class="star-on" style="width: 0;">
                                                <div class="star-on-wrap">
                                                    <span class="material-icons">grade</span> 
                                                    <span class="material-icons">grade</span> 
                                                    <span class="material-icons">grade</span>
                                                    <span class="material-icons">grade</span> 
                                                    <span class="material-icons">grade</span>
                                                </div>
                                            </div>
                                            <span class="material-icons">grade</span> 
                                            <span class="material-icons">grade</span> 
                                            <span class="material-icons">grade</span>
                                            <span class="material-icons">grade</span> 
                                            <span class="material-icons">grade</span>
                                        </div>
                                    </div>
                                    <p th:text="${review.reviewContent}"></p>
                                    <input class="star" type="hidden" th:value="${review.reviewStar}">
                                </div>
                            </th:block>
                        </div>
                    </div>
                </th:block>
            </div>
            
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </a>
        </div>
    </div>
    <th:block th:include="common/footer"></th:block>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // 레스토랑 별점 적용
            document.querySelectorAll(".restr").forEach(function(element) {
                const restaurantScore = parseFloat(element.querySelector(".star").value);
                const changeWidth = (restaurantScore / 5) * 100; // 각 별의 넓이 (0% - 100%)
                element.querySelector(".star-on").style.width = changeWidth + "%";
            });

            // 리뷰 별점 적용
            document.querySelectorAll(".review").forEach(function(review) {
                const reviewScore = parseFloat(review.querySelector(".star").value);
                const reviewChangeWidth = (reviewScore / 5) * 100;
                review.querySelector(".star-on").style.width = reviewChangeWidth + "%";
            });
        });
    </script>
</body>
</html>
